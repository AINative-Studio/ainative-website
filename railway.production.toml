# Railway Production Deployment Configuration
# Use with: railway up --config railway.production.toml

[build]
builder = "nixpacks"
buildCommand = "npm run build"

[deploy]
# Strict health checks for production
healthcheckPath = "/api/health"
healthcheckTimeout = 600
restartPolicyType = "on_failure"
restartPolicyMaxRetries = 5

startCommand = "npm run start"

# Production region (adjust as needed)
region = "us-west1"

# Zero-downtime deployment
replicas = 2
deploymentStrategy = "rolling"

[env]
NODE_ENV = "production"
NEXT_TELEMETRY_DISABLED = "1"

# Production optimizations
NODE_OPTIONS = "--max-old-space-size=4096"

[check]
# Comprehensive pre-deployment validation for production
preDeployCommand = "./scripts/pre-deploy-validation.sh production"
postDeployCommand = "./scripts/smoke-tests.sh $RAILWAY_PUBLIC_DOMAIN"

[healthcheck]
path = "/api/health"
interval = 30
timeout = 10
threshold = 5

[rollback]
# Automatic rollback on health check failure
enabled = true
healthCheckFailureThreshold = 3

[watch]
# Explicit control - production should use manual deployments
enabled = false
